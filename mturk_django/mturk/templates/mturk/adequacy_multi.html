<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>title</title>
  <style type="text/css">
  	body, .main-window {
  		background-color: #F3F3F3;
  	}

    body {
        margin: 0px;
       }

  	.main-window {
  		font-family: sans-serif;
  		
  		padding: 40px;
  		max-width: 768px;
  		margin: auto;
  	}

  	.statement {
  		text-align: center;
	    padding: 27px 10px;
	    font-weight: 900;
  	}

  	.sentence-container {
	    border: 1px solid #CCCCCC;
	    border-radius: 3px;
	    background-color: white;
	    line-height: 1.5em;
	    font-family: 'Georgia', serif;
        margin-bottom: 20px;
  	}

  	.rating-button {
	    width: 50px;
	    float: left;
	    text-align: center;
	}

	.rating-container {
		display: table;
	    margin: auto;
	    margin-top: 30px;
	}

	.rating-button label,
	.rating-button input {
		cursor: pointer;
		padding: 7px 15px 23px 15px;
	}

	.rating-button input {
		margin: 0px;
	    width: 18px;
	    height: 22px;
	}
    .rating-buttons {
        display: flex;
        align-items: center;
    }

    #rating-form-submit {
        margin: auto;
        display: table;
        margin-top: 19px;
        padding: 4px 28px;
        font-weight: 700;
    }
  
    #hit-counter {
       float: right;
       font-weight: bold;
       color: #5f5f5f;
    } 

    #preview{
        background-color: #eed7c0;
        padding: 18px 32px;
        margin-bottom: 24px;
    }

    #temple-header img {
        height: 45px;
        float: left;
    }

    #temple-header {
        border-bottom: 1px solid #c9c9c9;
        padding: 7px 12px;
        background-color: white;
        width: 100%;
        display: flex;
        align-items: center;
    }

    #dev-notice {
        font-family: sans-serif;
        font-size: 18px;
        padding: 5px 5px;
        margin-left: 21px;
    }

    #original-sentence-label {
        font-family: sans-serif;
        text-align: center;
        color: #868686;
        font-weight: 500;
    }

    div#original-container, .candidate {
        padding: 24px 52px;
        border-bottom: 1px solid #CCCCCC;
    }

  </style>
  </head>
  <body>
     <div id="temple-header">
          <img src="https://upload.wikimedia.org/wikipedia/commons/3/32/Temple_University_logo.png">
            {% if in_dev %}
            <div id="dev-notice">
                <strong>DEVELOPMENT</strong>
            </div>
            {% endif %}
     </div>
     <div class="main-window">
      {% if assignment_id == "ASSIGNMENT_ID_NOT_AVAILABLE" %}
      <div id="preview">
          Thank you for your interest in completing our HIT. Below you can find an example of a single HIT. Please click Accept to start the HIT.
      </div>
      {% endif %}
        <div class="description">
  	Below you will find a single sentence followed by several candidate translations of the sentence. 
    For each of the candidate sentences, use the scale below each sentence to indicate how much you agree with the following statement:

        <div id="hit-counter">0/100</div>
  		<div class="statement">
  		The candidate sentence adequately expresses the meaning of the original sentence.
  		</div>
  	</div>
    <div id="original-sentence-label">Original Sentence</div>
    <div id="original-container" class="sentence-container">
        <div id="original-sentence-container"></div>
    </div>
    <div id="original-sentence-label">Candidate Sentences</div>
    <form action="{{ amazon_host }}" method="POST" id="rating-form">
        <div class="sentence-container">
            <div class="candidate">
                <div class="sentence" id="top-sentence-container"></div>
                <div id="top-rating-container" class="rating-container">
                        <input type="hidden" name="workerId" value="{{ worker_id }}">
                        <input type="hidden" name="assignmentId" value="{{ assignment_id }}">
                        <input type="hidden" name="amazon_host" value="{{ amazon_host }}">
                        <input type="hidden" name="hitId" value="{{ hit_id }}">
                        <div class="rating-buttons">
                            <span style="float: left;color: #ff6161;font-weight: 600;">Strongly Disagree</span>
                                <div class="rating-button">
                                    <label for="top-3">-3</label><br><input id="top-3" type="radio" name="top-rating" value="-3"> 
                                </div>
                                <div class="rating-button">
                                    <label for="top-2">-2</label><br><input id="top-2" type="radio" name="top-rating" value="-2"> 
                                </div>
                                <div class="rating-button">
                                    <label for="top-1">-1</label><br><input id="top-1" type="radio" name="top-rating" value="-1"> 
                                </div>
                                <div class="rating-button">
                                    <label for="top0">0</label><br><input id="top0" type="radio" name="top-rating" value="0"> 
                                </div>
                                <div class="rating-button">
                                    <label for="top+1">+1</label><br><input id="top+1" type="radio" name="top-rating" value="+1"> 
                                </div>
                                <div class="rating-button">
                                    <label for="top+2">+2</label><br><input id="top+2" type="radio" name="top-rating" value="+2"> 
                                </div>
                                <div class="rating-button">
                                    <label for="top+3">+3</label><br><input id="top+3" type="radio" name="top-rating" value="+3"> 
                                </div>
                                <span style="font-weight: 600;color: #46c546">Strongly Agree</span>
                        </div>
                </div>
            </div>
            <div class="candidate">
                <div class="sentence" id="middle-sentence-container"></div>
                <div id="mid-rating-container" class="rating-container">
                        <input type="hidden" name="workerId" value="{{ worker_id }}">
                        <input type="hidden" name="assignmentId" value="{{ assignment_id }}">
                        <input type="hidden" name="amazon_host" value="{{ amazon_host }}">
                        <input type="hidden" name="hitId" value="{{ hit_id }}">
                        <div class="rating-buttons">
                            <span style="float: left;color: #ff6161;font-weight: 600;">Strongly Disagree</span>
                                <div class="rating-button">
                                    <label for="mid-3">-3</label><br><input id="mid-3" type="radio" name="mid-rating" value="-3"> 
                                </div>
                                <div class="rating-button">
                                    <label for="mid-2">-2</label><br><input id="mid-2" type="radio" name="mid-rating" value="-2"> 
                                </div>
                                <div class="rating-button">
                                    <label for="mid-1">-1</label><br><input id="mid-1" type="radio" name="mid-rating" value="-1"> 
                                </div>
                                <div class="rating-button">
                                    <label for="mid0">0</label><br><input id="mid0" type="radio" name="mid-rating" value="0"> 
                                </div>
                                <div class="rating-button">
                                    <label for="mid+1">+1</label><br><input id="mid+1" type="radio" name="mid-rating" value="+1"> 
                                </div>
                                <div class="rating-button">
                                    <label for="mid+2">+2</label><br><input id="mid+2" type="radio" name="mid-rating" value="+2"> 
                                </div>
                                <div class="rating-button">
                                    <label for="mid+3">+3</label><br><input id="mid+3" type="radio" name="mid-rating" value="+3"> 
                                </div>
                                <span style="font-weight: 600;color: #46c546">Strongly Agree</span>
                        </div>
                </div>
            </div>
            <div class="candidate">
                <div class="sentence" id="bottom-sentence-container"></div>
                <div id="low-rating-container" class="rating-container">
                        <input type="hidden" name="workerId" value="{{ worker_id }}">
                        <input type="hidden" name="assignmentId" value="{{ assignment_id }}">
                        <input type="hidden" name="amazon_host" value="{{ amazon_host }}">
                        <input type="hidden" name="hitId" value="{{ hit_id }}">
                        <div class="rating-buttons">
                            <span style="float: left;color: #ff6161;font-weight: 600;">Strongly Disagree</span>
                                <div class="rating-button">
                                    <label for="low-3">-3</label><br><input id="low-3" type="radio" name="low-rating" value="-3"> 
                                </div>
                                <div class="rating-button">
                                    <label for="low-2">-2</label><br><input id="low-2" type="radio" name="low-rating" value="-2"> 
                                </div>
                                <div class="rating-button">
                                    <label for="low-1">-1</label><br><input id="low-1" type="radio" name="low-rating" value="-1"> 
                                </div>
                                <div class="rating-button">
                                    <label for="low0">0</label><br><input id="low0" type="radio" name="low-rating" value="0"> 
                                </div>
                                <div class="rating-button">
                                    <label for="low+1">+1</label><br><input id="low+1" type="radio" name="low-rating" value="+1"> 
                                </div>
                                <div class="rating-button">
                                    <label for="low+2">+2</label><br><input id="low+2" type="radio" name="low-rating" value="+2"> 
                                </div>
                                <div class="rating-button">
                                    <label for="low+3">+3</label><br><input id="low+3" type="radio" name="low-rating" value="+3"> 
                                </div>
                                <span style="font-weight: 600;color: #46c546">Strongly Agree</span>
                        </div>
                </div>
            </div>
            <div class="candidate">
                <div class="sentence" id="bottomer-sentence-container"></div>
                <div id="lower-rating-container" class="rating-container">
                        <input type="hidden" name="workerId" value="{{ worker_id }}">
                        <input type="hidden" name="assignmentId" value="{{ assignment_id }}">
                        <input type="hidden" name="amazon_host" value="{{ amazon_host }}">
                        <input type="hidden" name="hitId" value="{{ hit_id }}">
                        <div class="rating-buttons">
                            <span style="float: left;color: #ff6161;font-weight: 600;">Strongly Disagree</span>
                                <div class="rating-button">
                                    <label for="lower-3">-3</label><br><input id="lower-3" type="radio" name="lower-rating" value="-3"> 
                                </div>
                                <div class="rating-button">
                                    <label for="lower-2">-2</label><br><input id="lower-2" type="radio" name="lower-rating" value="-2"> 
                                </div>
                                <div class="rating-button">
                                    <label for="lower-1">-1</label><br><input id="lower-1" type="radio" name="lower-rating" value="-1"> 
                                </div>
                                <div class="rating-button">
                                    <label for="lower0">0</label><br><input id="lower0" type="radio" name="lower-rating" value="0"> 
                                </div>
                                <div class="rating-button">
                                    <label for="lower+1">+1</label><br><input id="lower+1" type="radio" name="lower-rating" value="+1"> 
                                </div>
                                <div class="rating-button">
                                    <label for="lower+2">+2</label><br><input id="lower+2" type="radio" name="lower-rating" value="+2"> 
                                </div>
                                <div class="rating-button">
                                    <label for="lower+3">+3</label><br><input id="lower+3" type="radio" name="lower-rating" value="+3"> 
                                </div>
                                <span style="font-weight: 600;color: #46c546">Strongly Agree</span>
                        </div>
                </div>
            </div>
        </div>
        <input id="rating-form-submit" type="submit" value="Next">
    </form>
  	    
  </div>
  
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
  <script type="text/javascript">
   function autorun()
   {
       var maxCount = 50;
       $('#hit-counter').data("count", 0);
       var count = $("#hit-counter").data("count") ;
       $("#hit-counter").html((count + 1) +" of " + maxCount);

       // array to store the survey answers
       var answerData = [];
        
       // assign context to serverside object
       var context = {
            worker_id : "{{ worker_id }}",
            assignment_id : "{{ assignment_id }}",
            amazon_host : "{{ amazon_host }}",
            hit_id : "{{ hit_id }}",
       };

       $.getJSON("https://mturk.adeutry.info/adequacy_multi/get_hit_questions", function (res) {

           //update counter
           var maxCount = res.length
           $('#hit-counter').data("count", 0);
           $('#hit-counter').data("max-count", maxCount);
           var count = $("#hit-counter").data("count") ;
           $("#hit-counter").html((count + 1) +" of " + maxCount);
           
           //fill in questions
           var ques = res.pop();
           $("#rating-form").data("questions", res);
           $("#rating-form").data("currentQues", ques);
           var trans = ques['trans'];
           $("#original-sentence-container").html(ques['original']);
           $("#top-sentence-container").html(trans[0]['trans_text']);
           $("#middle-sentence-container").html(trans[1]['trans_text']);
           $("#bottom-sentence-container").html(trans[2]['trans_text']);
           $("#bottomer-sentence-container").html(trans[3]['trans_text']);
       });
       
       // initialize timer values for per-hit time and total Hit time
       $('#rating-form').data("timer-start", Date.now());
       $('#rating-form').data("hit-start-time", Date.now());

       $('#rating-form').submit(function(e) {

              // dont submit the form if questions remain
               if(!$("#rating-form").data("readyToSubmit")){
                  e.preventDefault();
               }

              // get the selected answer 
              var selectedAnswer = $(".rating-button input:checked");

              //check to see if the user even selected anything
              if( selectedAnswer.length != 4 ) {

                   console.log("Make a choice, silly!");

              } else if (!$("#rating-form").data("readyToSubmit")) {

                  // record elapsed time
                  var timeElapsed = (Date.now() - $("#rating-form").data("timer-start"))/1000;
                  $('#rating-form').data("timer-start", Date.now());

                  // add this answer to our answer list
                  var currentQues = $("#rating-form").data("currentQues")
                  var trans = currentQues['trans']
                  var answer = {
                      'original_id' : trans[0]['trans_id'],
                      'trans' : [
                          {
                              'trans_id' : trans[0]['trans_id'],
                              'answer' : $("#top-rating-container .rating-button input:checked")[0].value,
                              'type' : trans[0]['type']
                          },
                          {
                              'trans_id' : trans[1]['trans_id'],
                              'answer' : $("#mid-rating-container .rating-button input:checked")[0].value,
                              'type' : trans[1]['type']
                          },
                          {
                              'trans_id' : trans[2]['trans_id'],
                              'answer' : $("#low-rating-container .rating-button input:checked")[0].value,
                              'type' : trans[2]['type']
                          },
                          {
                              'trans_id' : trans[3]['trans_id'],
                              'answer' : $("#lower-rating-container .rating-button input:checked")[0].value,
                              'type' : trans[3]['type']
                          }
                      ]
                  };
                  answerData.push(answer);
                  $("#rating-form").data("answers", answerData);
                  count ++  ;

                  // check if need to get another sentence
                  if ( $("#rating-form").data("questions").length == 0 ) {

                      var answerDataJson = JSON.stringify(answerData);
                      var totalHitTime = (Date.now() - $('#rating-form').data("hit-start-time"))/1000;

                      //build hidden input containing answer data and add it to form
                      var answerDataInput = $("<input>")
                                            .attr("type", "hidden")
                                            .attr("name", "answerData").val(answerDataJson);

                       $("#rating-form").append($(answerDataInput));

                      //build input containing total hit time and add it for form
                      var hitTimeInput = $("<input>")
                                            .attr("type", "hidden")
                                            .attr("name", "totalHitTime").val(totalHitTime);

                      $('#rating-form').append(hitTimeInput);
                      $("#rating-form").data("readyToSubmit", true);
                      $("#rating-form").submit();

                  } else {

                        // get a new sentence
                        currentQues = $("#rating-form").data("questions").pop();
                        trans = currentQues['trans']
                        $("#rating-form").data("currentQues", currentQues);
                        $("#original-sentence-container").html(currentQues['original']);
                        $("#top-sentence-container").html(trans[0]['trans_text']);
                        $("#middle-sentence-container").html(trans[1]['trans_text']);
                        $("#bottom-sentence-container").html(trans[2]['trans_text']);
                        $(".rating-button input:checked").prop("checked", false);
                        $("#hit-counter").html((count + 1) +" of " + $("#hit-counter").data("max-count"));
                  }

              }
        });  
  
   }
   if (window.addEventListener) window.addEventListener("load", autorun, false);
   else if (window.attachEvent) window.attachEvent("onload", autorun);
   else window.onload = autorun;
  </script>
  </body>
</html>
